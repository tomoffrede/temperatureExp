---
title: "Analysis - Temperature"
author: "Tom Offrede"
output:
  html_document:
    toc: true
    toc_float: 
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(tidyverse)
library(lmerTest)
library(broom)
library(DHARMa)
library(parsnip)

load(paste0(here::here(), "/data/tempData.RData"))
load(paste0(here::here(), "/data/tempDataChange.RData"))
load(paste0(here::here(), "/data/metadata-clean.RData"))
meta <- m
folderFig1 <- paste0(here::here(), "/figures/temperature/tempChange/")
folderFig2 <- paste0(here::here(), "/figures/temperature/convergence/")
```

# Summary: Most interesting results

* Most people increased the temperature in most of their ROIs, with some exceptions.

**Significant number of increases/decreases in temperature** (per speaker)
* The **nose** changed temperature **more** often in the impersonal condition.
* The **forehead** changed temperature **less** often with higher *openness* scores.
* The **cheeks** changed/increased temperature **less** when the participant felt more *similar* to their partner.

**Participants' temperature change across conditions** (all speakers together)
* The **forehead** changed temperature **less** when the speaker liked their partner *more*.
* The **cheeks** changed temperature **more** when the speaker scored higher on *agreeableness*.

# Notes about models and data

* There are 2 types of analysis:
    + Run a regression on ROI's temperature ~ time passing *for each speaker*, and then use the result of these regressions (significant increase, significant decrease, not significant) as a dependent variable of other predictors (e.g., condition and questionnaire ratings)
    + Run a regression with the speakers' absolute temperature change across the experiment (numerical) and use this as a dependent variable of other predictors.

* In the models of temperature change across time, I originally wanted to add `room temperature` as a predictor to account for the increasing room temperature. However, there is high collinearity between `room temperature` and `time`, so the models don't make sense. Hence, only `time` is kept.

* There are 2 conditions: `close`, where in the first task of the experiment the participants talked about increasingly intimate questions (adapted from the Relationship Closeness Induction Task), and `impersonal`, where they talked about impersonal questions.

* The check of residuals of logistic models below, was done following: https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html

# Individual plots

See folder: R project temperatureExp > figures > temperature > tempChange OR convergence

```{r}
# for(roi in unique(dat$ROI)){
#   ggplot(dat |> filter(ROI==roi), aes(time, temperature, color=speaker))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(roi)
#   ggsave(paste0(folderFig1, roi, ".png"), width=3000, height=2600, units = "px")
#   
#   for(con in unique(dat$condition)){
#     ggplot(dat |> filter(ROI==roi, condition==con), aes(time, temperature, color=speaker))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(paste(roi, "-", con, "condition"))
#   ggsave(paste0(folderFig1, "/", con, "/", roi, ".png"), width=3000, height=2600, units = "px")
#   }
# }
```

```{r}
# for(roi in unique(dat$ROI)){
#   d <- dat |>
#     filter(ROI==roi) |> 
#     group_by(speaker) |>
#     filter(length(unique(task))==2) |>
#     ungroup()
#     ggplot(d, aes(time, temperature, color=task))+
#       geom_point()+
#       geom_smooth(method="lm")+
#       facet_wrap(~speaker, scales = "free_x")+
#       ggtitle(roi)
#     ggsave(paste0(folderFig1, roi, "PerTask.png"), width=3000, height=2600, units = "px")
# }
```

```{r}
# for(roi in unique(dat$ROI)){
#   ggplot(dat |> filter(ROI==roi, grepl("-A", speaker)), aes(time, tempDiff))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(roi)
#   ggsave(paste0(folderFig2, roi, ".png"), width=3000, height=2600, units = "px")
#   
#   for(con in unique(dat$condition)){
#     ggplot(dat |> filter(ROI==roi, grepl("-A", speaker), condition==con), aes(time, tempDiff))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(paste(roi, "-", con, "condition"))
#   ggsave(paste0(folderFig2, "/", con, "/", roi, ".png"), width=3000, height=2600, units = "px")
#   }
# }
```

# Temperature change across time and across conditions

## Per speaker

```{r}
all <- data.frame(matrix(nrow=0, ncol=7))
names(all) <- c("speaker", "condition", "ROI", "direction", "t", "p", "section")
```

```{r}
for(s in unique(dat$speaker)){
  for(r in unique(dat$ROI)){
    d <- dat |> filter(speaker==s, ROI==r)
    if(nrow(d)<=1){next}
    c <- tidy(lm(temperature ~ time, d))
    all[nrow(all)+1,] <- c(s, unique(d$condition), r,
                           ifelse(c$estimate[2] < 0, "negative", "positive"),
                           c$statistic[2],
                           c$p.value[2],
                           "entireExp")
    for(section in c("Lists", "Diapix")){
      d <- dat |> filter(speaker==s, ROI==r, task==section)
      if(nrow(d)==0){next}
      c <- tidy(lm(temperature ~ time, d))
      all[nrow(all)+1,] <- c(s, unique(d$condition), r,
                             ifelse(c$estimate[2] < 0, "negative", "positive"),
                             c$statistic[2],
                             c$p.value[2],
                             section)
    }
  }
}

all <- all |> 
  mutate_at(c("direction", "speaker", "condition", "section", "ROI"), as.factor) |> 
  mutate_at(c("t", "p"), as.numeric) |> 
  mutate(sign = ifelse(p < 0.05, "yes", "ns"),
         effect = case_when(
           sign == "yes" & direction == "positive" ~ "increase",
           sign == "yes" & direction == "negative" ~ "decrease",
           sign == "ns" ~ "ns",
         ))

# # save it
# indTemp <- all
# save(indTemp, file=paste0(here::here(), "/data/individualTemp.RData"))
```

There were more significant changes within each section than when the entire experiment period was taken. This seems meaningful, since the entire experiment has more data points than each section individually.
```{r}
table(paste(all$sign, all$section))
```

But the direction of temperature change was always the same (mostly positive) in each section.

The individual plots divided per 1st vs 2nd part of experiment show that most participants had a linear change across the experiment, but not all.
```{r}
summary(glmer(direction ~ section + (1|speaker), all |> filter(section!="entireExp"), family=binomial))
```

### Questionnaire scores as predictors?

Use dataset with effects relating to each task
```{r}
d <- merge(all |> 
             filter(section != "entireExp") |> 
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

#### Nose

There were more significant nose temperature change effects in the impersonal condition.
```{r}
ggplot(d |> filter(ROI=="Nose"), aes(effect))+
  geom_bar()+
  facet_wrap(~condition)+
  ggtitle("NOSE: temperature change across conditions")

summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(m <- glmer(condition ~ effect + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))

# the residuals seem ok
simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

#### Eyes

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))

# the residuals seem ok
simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

#### Forehead

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

# the residuals seem ok
simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

Openness seemed to predict *less* significant temperature change in the forehead.
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(effect, openness))+
  geom_boxplot()+
  ggtitle("FOREHEAD: Openness scores--less temp change")

summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

# residuals of the openness model: seem ok
simulateResiduals(m, plot = T)
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

#### Cheeks

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

Participants that felt more similar to their partner tended *less* to increase cheek temperature
```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(effect, similarity))+
  geom_boxplot()+
  ggtitle("CHEEKS: Similarity--less temp change/increase")

summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))

# residuals of the openness model: seem ok
simulateResiduals(m, plot = T)
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```


## All speakers together

### Temperature across time

#### Nose

Nose got warmer across time, no difference between conditions.

Preferred model: `temperature ~ time + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Nose"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (time||speaker) , dat |> filter(ROI=="Nose")))

summary(m1 <- lmer(temperature ~ time : condition + roomTemp + (time||speaker), dat |> filter(ROI=="Nose")))

anova(m0, m1)
```

#### Forehead

Forehead got warmer across time, no difference between conditions.

Preferred model: `(temperature ~ time + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Forehead"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Forehead")))
summary(m1 <- lmer(temperature ~ time : condition + (1+time|speaker), dat |> filter(ROI=="Forehead")))

anova(m0, m1)
```

#### Eyes

Eyes got warmer across time, no difference between conditions.

Preferred model: `(temperature ~ time + (1+time|speaker)`


```{r}
ggplot(dat |> filter(ROI=="Eyes"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Eyes")))
summary(m1 <- lmer(temperature ~ time : condition + (1+time|speaker), dat |> filter(ROI=="Eyes")))

anova(m0, m1)
```

#### Cheeks

Cheeks did not change temperature.

Preferred model: `(temperature ~ time + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Cheeks"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Cheeks")))
summary(m1 <- lmer(temperature ~ time : condition + (1+time|speaker), dat |> filter(ROI=="Cheeks")))

anova(m0, m1)
```

### Temperature difference -- exploration of possible predictors

All the effects below are small and with the residuals not normally distributed. This is probably due to the small size of the data set. So these effects aren't the most reliable.

#### Nose

No condition effect.
```{r}
summary(lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect with BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

#### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

#### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

It seems that people that *liked* their partner more changed forehead temperature *less*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(likeability, tempChangeEntireExp))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change: how much partner is liked")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


#### Cheeks

No effect of condition.
```{r}
summary(m <- lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effect of their perception of their partner.
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

Participants who scored higher on *agreeableness* changed their cheek temperature more.
```{r}
ggplot(datChange |> filter(ROI=="Cheeks"), aes(agreeableness, tempChangeEntireExp))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("CHEEKS change & agreeableness score")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```


# Temperature difference across time (convergence)

## Per dyad

```{r}
all <- data.frame(matrix(nrow=0, ncol=7))
names(all) <- c("dyad", "condition", "ROI", "direction", "t", "p", "section")
```

```{r}
for(d in unique(dat$dyad)){
  for(r in unique(dat$ROI)){
    dd <- dat |> 
      filter(speaker==paste0(d, "-A"), ROI==r)
    if(nrow(dd)<=1){next}
    if(all(is.na(dd$tempDiff))){next}
    c <- tidy(lm(tempDiff ~ time, dd))
    all[nrow(all)+1,] <- c(d, unique(dd$condition[dd$dyad==d]), r,
                           ifelse(c$estimate[2] < 0, "convergence", "divergence"),
                           c$statistic[2],
                           c$p.value[2],
                           "entireExp")
    for(section in c("Lists", "Diapix")){
      dd <- dat |> 
        filter(speaker==paste0(d, "-A"), ROI==r, task==section)
      if(nrow(dd)<=1){next}
      if(all(is.na(dd$tempDiff))){next}
      c <- tidy(lm(tempDiff ~ time, dd))
      all[nrow(all)+1,] <- c(d, unique(dd$condition[dd$dyad==d]), r,
                             ifelse(c$estimate[2] < 0, "convergence", "divergence"),
                             c$statistic[2],
                             c$p.value[2],
                             section)
    }
  }
}

all <- all |> 
  mutate_at(c("t", "p"), as.numeric) |> 
  mutate(sign = ifelse(p<0.05, "yes", "ns"),
         effect = case_when(
           sign == "yes" & direction == "convergence" ~ "convergence",
           sign == "yes" & direction == "divergence" ~ "divergence",
           sign == "ns" ~ "ns"
         )) |> 
  mutate_at(c("direction", "dyad", "condition", "section", "ROI", "sign", "effect"), as.factor)
all$section <- factor(all$section, levels=c("Lists", "Diapix", "entireExp"))
all$ROI <- factor(all$ROI, levels=c("Forehead", "Eyes", "Nose", "Cheeks"))
```

Some dyads converged (or diverged) on some ROIs.
```{r}
table(all$sign)
ggplot(all, aes(ROI))+
  geom_bar()+
  facet_grid(effect~section)+
  ggtitle("Significance of effects of con-/divergence in ROIs")
```


```{r}
ggplot(all |> filter(effect!="ns", section=="entireExp"), aes(ROI))+
  geom_bar()+
  facet_wrap(condition~effect)+
  ggtitle("Significant effects per condition, ROI & type")
```

Neither the direction of the effect (con- vs. divergence) nor the presence of an effect (significant or not) is different between conditions.
```{r}
summary(glmer(effect ~ condition + (1|dyad), all |> filter(effect!="ns"), family=binomial))
summary(glmer(sign ~ condition + (1|dyad), all, family=binomial))
```

Dyads that show an effect in one ROI are likely to show an effect in other ROIs.
```{r}
sort(table(all$dyad[all$sign!="ns" & all$section=="entireExp"]))
hist(table(all$dyad[all$sign!="ns" & all$section=="entireExp"]), main="Number of effects shown by each given dyad", xlab="Number of effects (eg, in different ROIs)")
```

(I'd like to explore whether dyads converge more/less using questionnaire scores as predictors, but I'm not sure how to do that, since the questionnaires were 1 per speaker, and the convergence measure is 1 per dyad.)

## All speakers together

**There was no robust convergence or divergence in any ROI when all speakers' data are pulled together.** Although there seemed to be a trend in some ROIs, the effect disappears completely when we add random slopes to the models.

### Nose

No con-/divergence in nose temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Nose"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Nose", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Nose", grepl("-A", speaker))))

anova(m0, m1)
```

### Forehead

No con-/divergence in forehead temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Forehead"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Forehead", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Forehead", grepl("-A", speaker))))

anova(m0, m1)
```

### Eyes

No con-/divergence in eye temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Eyes"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Eyes", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Eyes", grepl("-A", speaker))))

anova(m0, m1)
```

### Cheeks

No con-/divergence in cheek temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Cheeks"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Cheeks", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Cheeks", grepl("-A", speaker))))

anova(m0, m1)
```

# Session Info

```{r}
sessionInfo()
```

