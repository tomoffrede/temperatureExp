---
title: "Analysis - Temperature"
author: "Tom Offrede"
output:
  html_document:
    toc: true
    toc_float: 
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(tidyverse)
library(lmerTest)
library(broom)
library(DHARMa)
library(parsnip)

load(paste0(here::here(), "/data/tempData.RData"))
load(paste0(here::here(), "/data/tempDataChange.RData"))
load(paste0(here::here(), "/data/metadata-clean.RData"))
meta <- m
folderFig1 <- paste0(here::here(), "/figures/temperature/tempChange/")
folderFig2 <- paste0(here::here(), "/figures/temperature/convergence/")
```

# Summary: Most interesting results

* Most people increased the temperature in most of their ROIs, with some exceptions.

**Significant number of increases/decreases in temperature** (per speaker)

* There were overall more significant changes (mostly increases) in the impersonal condition. This was true for the following specific ROIs:
    * First part of experiment
        * Nose increases and decreases
        ... continue
        (see also: are the results of the inc/dec/ns per questionnaire answer the same as when we consider the numerical values?)
        
* The **nose** changed temperature **more** often in the impersonal condition.
* The **forehead** changed temperature **less** often with higher *openness* scores.
* The **cheeks** changed/increased temperature **less** often when the participant felt more *similar* to their partner.

**Participants' temperature change across conditions** (all speakers together)

* **Nose** temperature change was **less positive** when the speaker scored higher on *extraversion*.
* **Forehead** temperature change was **less positive** when the speaker liked their partner **more**.
* **Forehead** temperature change was **less positive** when the speaker scored higher on *openness*.
* **Cheeks** temperature change was **less positive** when the speaker liked their partner **more**.

# Notes

* There are 2 types of analysis:
+ Run a regression on ROI's temperature ~ time passing *for each speaker*, and then use the result of these regressions (significant increase, significant decrease, not significant) as a dependent variable of other predictors (e.g., condition and questionnaire ratings)
+ Run a regression with the speakers' absolute temperature change across the experiment (numerical) and use this as a dependent variable of other predictors.

* In the models of temperature change across time, I originally wanted to add `room temperature` as a predictor to account for the increasing room temperature. However, there is high collinearity between `room temperature` and `time`, so the models don't make sense. Hence, only `time` is kept.

* There are 2 conditions: `close`, where in the first task of the experiment the participants talked about increasingly intimate questions (adapted from the Relationship Closeness Induction Task), and `impersonal`, where they talked about impersonal questions.

* The check of residuals of logistic models below, was done following: https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html

# Individual plots

See folder: R project temperatureExp > figures > temperature > tempChange OR convergence

```{r}
# for(roi in unique(dat$ROI)){
#   ggplot(dat |> filter(ROI==roi), aes(time, temperature, color=speaker))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(roi)
#   ggsave(paste0(folderFig1, roi, ".png"), width=3000, height=2600, units = "px")
#   
#   for(con in unique(dat$condition)){
#     ggplot(dat |> filter(ROI==roi, condition==con), aes(time, temperature, color=speaker))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(paste(roi, "-", con, "condition"))
#   ggsave(paste0(folderFig1, "/", con, "/", roi, ".png"), width=3000, height=2600, units = "px")
#   }
# }
```

```{r}
# for(roi in unique(dat$ROI)){
#   d <- dat |>
#     filter(ROI==roi) |> 
#     group_by(speaker) |>
#     filter(length(unique(task))==2) |>
#     ungroup()
#     ggplot(d, aes(time, temperature, color=task))+
#       geom_point()+
#       geom_smooth(method="lm")+
#       facet_wrap(~speaker, scales = "free_x")+
#       ggtitle(roi)
#     ggsave(paste0(folderFig1, roi, "PerTask.png"), width=3000, height=2600, units = "px")
# }
```

```{r}
# for(roi in unique(dat$ROI)){
#   ggplot(dat |> filter(ROI==roi, grepl("-A", speaker)), aes(time, tempDiff))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(roi)
#   ggsave(paste0(folderFig2, roi, ".png"), width=3000, height=2600, units = "px")
#   
#   for(con in unique(dat$condition)){
#     ggplot(dat |> filter(ROI==roi, grepl("-A", speaker), condition==con), aes(time, tempDiff))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(paste(roi, "-", con, "condition"))
#   ggsave(paste0(folderFig2, "/", con, "/", roi, ".png"), width=3000, height=2600, units = "px")
#   }
# }
```

# Temperature change across time and across conditions

## Per speaker

```{r}
all <- data.frame(matrix(nrow=0, ncol=7))
names(all) <- c("speaker", "condition", "ROI", "direction", "t", "p", "section")
```

```{r}
for(s in unique(dat$speaker)){
  for(r in unique(dat$ROI)){
    d <- dat |> filter(speaker==s, ROI==r)
    if(nrow(d)<=1){next}
    c <- tidy(lm(temperature ~ time, d))
    all[nrow(all)+1,] <- c(s, unique(d$condition), r,
                           ifelse(c$estimate[2] < 0, "negative", "positive"),
                           c$statistic[2],
                           c$p.value[2],
                           "entireExp")
    for(section in c("Lists", "Diapix")){
      d <- dat |> filter(speaker==s, ROI==r, task==section)
      if(nrow(d)==0){next}
      c <- tidy(lm(temperature ~ time, d))
      all[nrow(all)+1,] <- c(s, unique(d$condition), r,
                             ifelse(c$estimate[2] < 0, "negative", "positive"),
                             c$statistic[2],
                             c$p.value[2],
                             section)
    }
  }
}

all <- all |> 
  mutate_at(c("t", "p"), as.numeric) |> 
  mutate(sign = ifelse(p < 0.05, "yes", "ns"),
         effect = case_when(
           sign == "yes" & direction == "positive" ~ "increase",
           sign == "yes" & direction == "negative" ~ "decrease",
           sign == "ns" ~ "ns",
         )) |> 
  mutate_at(c("direction", "speaker", "effect", "condition", "section", "ROI"), as.factor)

all$section <- factor(all$section, levels=c("Lists", "Diapix", "entireExp"))
all$effect <- relevel(all$effect, ref="ns")

# # save it
# indTemp <- all
# save(indTemp, file=paste0(here::here(), "/data/individualTemp.RData"))
```

There were more significant changes within each section than when the entire experiment period was taken. This seems meaningful, since the entire experiment has more data points than each section individually.
```{r}
table(paste(all$sign, all$section))
```

But the direction of temperature change was always the same (mostly positive) in each section.

The individual plots divided per 1st vs 2nd part of experiment show that most participants had a linear change across the experiment, but not all.
```{r}
summary(glmer(direction ~ section + (1|speaker), all |> filter(section!="entireExp"), family=binomial))
```

```{r}
ggplot(all, aes(ROI, fill=effect))+
  geom_bar()+
  facet_wrap(condition~section)+
  ggtitle("Temperature change across ROIs & conditions")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```


### Questionnaire scores as predictors?

#### First part of experiment (Lists)

```{r}
d <- merge(all |> 
             filter(section == "Lists") |>
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

```{r}
# data set for poisson regression

dt <- d |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n())
conditionCount <- d |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
contrasts(dt$condition) <- c(-.5,+.5)
```

##### All ROIs together

* With all ROIs taken together, there were overall more changes in the impersonal condition, both increases and decreases.

```{r}
ggplot(d, aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("All ROIs: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

```{r}
ggplot(d, aes(condition, fill=sign))+
  geom_bar()+
  ggtitle("All ROIs: number of significant changes (Lists)")+
  scale_fill_manual(values = c("ns" = "gray", "yes" = "black"))
```

```{r}
summary(m <- glm(count ~ effect / condition + offset(condCount), dt, family="poisson"))
```

```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d, family=binomial))

# the residuals seem ok
# simulateResiduals(m, plot = T)
```


##### Nose

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("NOSE: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

Nose temperature tended to *increase more often* (strongly) and also *decrease more often* (less robustly) in the *impersonal* condition.

(Interpretation of the negative binomial model below, which is the same as for nested effects in a poisson model
* Line 2 of the tibble: decrease is less likely to occur in condition close than "ns" (not significant)
* Line 3: increase is more likely to occur in condition close than "ns" (not significant)
* Line 4: "ns" in condition impersonal is more likely than "ns" in condition close, but not significant.
* Line 5: decrease in condition impersonal is more likely than decrease in condition close (significantly)
* Line 6: increase in condition impersonal is more likely than increase in condition close (significantly))
```{r}
# first fit a negative binomial regression, in case the count data is overdispersed
summary(nb <- MASS::glm.nb(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Nose")))

# and then check if, indeed the negative binomial model is preferred to the corresponding poisson model
pscl::odTest(nb)
# the low p value indicates that indeed the count data is overdispersed and the negative binomial model, which is more conservative, is more fitted here

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))

# ggeffects::ggpredict(nb, terms=c("effect", "condition")) |>
#   as_tibble()

# two (more) options of plots:

# ggeffects::ggpredict(m, terms=c("effect", "condition")) |> 
#   as_tibble()  |>
#   ggplot() +
#   aes(x = group, y = predicted) +
#   facet_grid(.~x) +
#   geom_point() +
#   geom_errorbar(aes(ymin=conf.low, ymax = conf.high)) +
#   geom_line(group = 1)
# 
# ggeffects::ggpredict(m, terms=c("effect", "condition")) |> 
#   as_tibble()  |>
#   ggplot() +
#   aes(x = group, y = predicted) +
#   facet_grid(.~x) +
#   geom_col() +
#   geom_errorbar(aes(ymin=conf.low, ymax = conf.high), width = .3)

```

Apparently no effect of condition on the number of significant changes.
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))

# the residuals seem ok
# simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

##### Eyes

```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("EYES: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Eyes increased temperature *more often* in the *impersonal* condition.
* There were more *ns* effects in the *impersonal* condition.
```{r}
# the negative binomial model wasn't even running (not a matter of convergence, the function is just not working despite it being exactly the same as the model used for `Nose`. so run the poisson regression directly)

summary(m <- glm(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Eyes"), family="poisson"))

tidy(m) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition on number of significant changes.
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))

# the residuals seem ok
simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

##### Forehead

```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("FOREHEAD: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Forehead temperature changed *more often* (in general) in the *close* condition.
* Forehead temperature increased *more often* in the *impersonal* condition.

(Does this make sense?)
```{r}
# the negative binomial model wasn't even running (not a matter of convergence, the function is just not working despite it being exactly the same as the model used for `Nose`. so run the poisson regression directly)

summary(m <- glm(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Forehead"), family="poisson"))

tidy(m) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

# the residuals seem ok
simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

Openness seemed to predict *less* significant temperature change in the forehead.
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(effect, openness))+
  geom_boxplot()+
  ggtitle("FOREHEAD: Openness scores--less temp change")

summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

# residuals of the openness model: seem ok
simulateResiduals(m, plot = T)
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

##### Cheeks

```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("CHEEKS: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Cheek temperature *changed more often* in the *impersonal* condition.
    * Cheek temperature *decreased more often* in the *impersonal* condition.
    * Cheek temperature also *increased more often* in the *impersonal* condition.
```{r}
# again, the negative binomial model isn't fitting correctly, so we fit directly a poisson model

summary(m <- glm(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Cheeks"), family="poisson"))

tidy(m) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

Participants that felt more similar to their partner tended *less* to increase cheek temperature
```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(effect, similarity))+
  geom_boxplot()+
  ggtitle("CHEEKS: Similarity--less temp change/increase")

summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))

# residuals of the openness model: seem ok
simulateResiduals(m, plot = T)
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

#### Second part of experiment (Diapix)

```{r}
d <- merge(all |> 
             filter(section == "Diapix") |>
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

```{r}
# data set for poisson regression

dt <- d |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n())
conditionCount <- d |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
contrasts(dt$condition) <- c(-.5,+.5)
```

##### All ROIs together

* In the second part of the experiment, it was even clearer that overall all ROIs changed more in the impersonal condition.

```{r}
ggplot(d, aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("All ROIs: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

```{r}
ggplot(d, aes(condition, fill=sign))+
  geom_bar()+
  ggtitle("All ROIs: number of significant changes (Lists)")+
  scale_fill_manual(values = c("ns" = "gray", "yes" = "black"))
```

```{r}
summary(m <- glm(count ~ effect / condition + offset(condCount), dt, family="poisson"))
```

```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d, family=binomial))

# the residuals seem ok
# simulateResiduals(m, plot = T)
```


##### Nose

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("NOSE: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Nose temperature *increased* more often than having no effect in the *close* condition.
* Nose temperature *increased* **and** *decreased* more often in the *impersonal* condition.
```{r}
# first fit a negative binomial regression, in case the count data is overdispersed
summary(nb <- MASS::glm.nb(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Nose")))

# and then check if, indeed the negative binomial model is preferred to the corresponding poisson model
pscl::odTest(nb)
# the low p value indicates that indeed the count data is overdispersed and the negative binomial model, which is more conservative, is more fitted here

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

Apparently no effect of condition on the number of significant changes.
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))

# the residuals seem ok
# simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

Nose temperature tended to *change more often* when the speaker scored higher on *openness*.

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(sign, openness))+
  geom_boxplot()
```

```{r}
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))

summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

##### Eyes

```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("EYES: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Eyes increased temperature *more often* in the *impersonal* condition.
* Eyes decreased temperature *less often* overall.
* There were less *ns* effects in the *impersonal* condition.
```{r}
# first fit a negative binomial regression, in case the count data is overdispersed
summary(nb <- MASS::glm.nb(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Eyes")))

# and then check if, indeed the negative binomial model is preferred to the corresponding poisson model
pscl::odTest(nb)
# the negative binomial model is preferred due to overdispersion in the count data

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition on number of significant changes.
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

##### Forehead

```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("FOREHEAD: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Forehead temperature decreased *less often* overall.
* Forehead temperature increased *more often* in the *impersonal* condition.
```{r}
# the negative binomial model didn't even run (not a matter of convergence, the function is just not working despite it being exactly the same as the model used for `Nose`. so run the poisson regression directly)

summary(m <- glm(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Forehead"), family="poisson"))

tidy(m) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition on amount of significant changes (but almost)
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

Forehead temperature *changed less often* when the speaker liked their partner *more* -- but the residuals are not ok!
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(sign, likeability))+
  geom_boxplot()
```

```{r}
summary(m <- glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

# residuals of the openness model: don't seem ok!
simulateResiduals(m, plot = T)
```

Forehead temperature changed *more often* when the speaker scored higher on *openness*.
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(sign, openness))+
  geom_boxplot()+
  ggtitle("FOREHEAD: Openness scores--less temp change")
```

```{r}
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))

# residuals of the openness model: seem ok
simulateResiduals(m, plot = T)
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

##### Cheeks

```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("CHEEKS: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Cheek temperature *decreased more often* in the *impersonal* condition.
* Cheek temperature also *increased more often* in the *impersonal* condition.

(The model also seems to suggest that there were more "ns" effects in the impersonal condition, but that doesn't make sense...)
```{r}
# first fit a negative binomial regression, in case the count data is overdispersed
summary(nb <- MASS::glm.nb(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Cheeks")))

# and then check if, indeed the negative binomial model is preferred to the corresponding poisson model
pscl::odTest(nb)
# the low p value indicates that indeed the count data is overdispersed and the negative binomial model, which is more conservative, is more fitted here

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of their perception of their partner.
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

#### Entire experiment

```{r}
d <- merge(all |> 
             filter(section == "entireExp") |>
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

```{r}
# data set for poisson regression

dt <- d |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n())
conditionCount <- d |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
contrasts(dt$condition) <- c(-.5,+.5)
```

##### All ROIs together

* With all ROIs taken together, there were overall more changes in the impersonal condition, both increases and decreases.

```{r}
ggplot(d, aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("All ROIs: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

```{r}
ggplot(d, aes(condition, fill=sign))+
  geom_bar()+
  ggtitle("All ROIs: number of significant changes (Lists)")+
  scale_fill_manual(values = c("ns" = "gray", "yes" = "black"))
```

```{r}
summary(m <- glm(count ~ effect / condition + offset(condCount), dt, family="poisson"))
```

```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d, family=binomial))

# the residuals seem ok
# simulateResiduals(m, plot = T)
```


##### Nose

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("NOSE: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Nose temperature *increased* more often than having no effect in the *close* condition.
* Nose temperature *increased* **and** *decreased* more often in the *impersonal* condition.
```{r}
# first fit a negative binomial regression, in case the count data is overdispersed
summary(nb <- MASS::glm.nb(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Nose")))

# and then check if, indeed the negative binomial model is preferred to the corresponding poisson model
pscl::odTest(nb)
# the low p value indicates that indeed the count data is overdispersed and the negative binomial model, which is more conservative, is more fitted here

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

Model not converging.
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))

# the residuals seem ok
# simulateResiduals(m, plot = T)
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of BFI scores.
```{r}
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial)) # not converging
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

##### Eyes

```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("EYES: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Eyes increased temperature *more often* in the *impersonal* condition.
* There were more *ns* effects in the *impersonal* condition.
```{r}
# the negative binomial model doesn't run, so we do the poisson model directly

summary(m <- glm(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Eyes"), family="poisson"))

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))

ggeffects::ggpredict(m, terms=c("effect", "condition")) |> 
  as_tibble()
```

Model not converging
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of their perception of their partner
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

Eye temperature changed *less often* when the speaker scored *higher* on *neuroticism*.
```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(sign, neuroticism))+
  geom_boxplot()
```

```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

##### Forehead

```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("FOREHEAD: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Forehead temperature increased *more often* in the *impersonal* condition.
```{r}
# the negative binomial model didn't even run (not a matter of convergence, the function is just not working despite it being exactly the same as the model used for `Nose`. so run the poisson regression directly)

summary(m <- glm(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Forehead"), family="poisson"))

tidy(m) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition on amount of significant changes (but almost)
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

No effect of perception of partner.
```{r}
summary(m <- glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

No effect of BFI scores.
```{r}
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

##### Cheeks

```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("CHEEKS: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

* Cheek temperature *decreased more often* in the *impersonal* condition.
* Cheek temperature also *increased more often* in the *impersonal* condition.

(The model also seems to suggest that there were more "ns" effects in the impersonal condition, but that doesn't make sense...)
```{r}
# first fit a negative binomial regression, in case the count data is overdispersed
summary(nb <- MASS::glm.nb(count ~ effect / condition + offset(condCount), dt |> filter(ROI=="Cheeks")))

# and then check if, indeed the negative binomial model is preferred to the corresponding poisson model
pscl::odTest(nb)
# the low p value indicates that indeed the count data is overdispersed and the negative binomial model, which is more conservative, is more fitted here

tidy(nb) |> 
  as_tibble() |> 
  mutate(estimate = exp(estimate))
```

No effect of condition
```{r}
summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of their perception of their partner.
```{r}
summary(glmer(sign ~ closeness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ similarity + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ likeability + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ becomeFriends + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of BFI scores
```{r}
summary(glmer(sign ~ extraversion + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(m <- glmer(sign ~ openness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ agreeableness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ conscientiousness + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ neuroticism + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of thermal comfort
```{r}
summary(glmer(sign ~ comfortPre + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
summary(glmer(sign ~ comfortPost + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

## All speakers together

### Temperature across time

#### Nose

Nose got warmer across time, no difference between conditions.

Preferred model: `temperature ~ time + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Nose"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (time||speaker) , dat |> filter(ROI=="Nose")))

summary(m1 <- lmer(temperature ~ time : condition + roomTemp + (time||speaker), dat |> filter(ROI=="Nose")))

anova(m0, m1)
```

#### Forehead

Forehead got warmer across time, no difference between conditions.

Preferred model: `(temperature ~ time + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Forehead"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Forehead")))
summary(m1 <- lmer(temperature ~ time : condition + (1+time|speaker), dat |> filter(ROI=="Forehead")))

anova(m0, m1)
```

#### Eyes

Eyes got warmer across time, no difference between conditions.

Preferred model: `(temperature ~ time + (1+time|speaker)`


```{r}
ggplot(dat |> filter(ROI=="Eyes"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Eyes")))
summary(m1 <- lmer(temperature ~ time : condition + (1+time|speaker), dat |> filter(ROI=="Eyes")))

anova(m0, m1)
```

#### Cheeks

Cheeks did not change temperature.

Preferred model: `(temperature ~ time + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Cheeks"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Cheeks")))
summary(m1 <- lmer(temperature ~ time : condition + (1+time|speaker), dat |> filter(ROI=="Cheeks")))

anova(m0, m1)
```

### Temperature difference -- exploration of possible predictors

All the effects below are small and with the residuals not normally distributed. This is probably due to the small size of the data set. So these effects aren't the most reliable.

### Entire Experiment

#### Nose

No condition effect.
```{r}
summary(lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

Nose temperature change was *less positive* when the person scored higher on extraversion.
```{r}
ggplot(datChange |> filter(ROI=="Nose"), aes(tempChangeEntireExp, extraversion))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("NOSE change & extraversion")
```


```{r}
summary(m <- lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

#### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

#### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

It seems that people that *liked* their partner more changed forehead temperature *less positively*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(likeability, tempChangeEntireExp))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change: how much partner is liked")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

People changed their forehead temperature *less positively* when they scored *higher* in *openness*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(openness, tempChangeEntireExp))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & openness score")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


#### Cheeks

No effect of condition.
```{r}
summary(m <- lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

Cheeks changed temperature *less positively* when the speaker liked their partner *more*.
```{r}
ggplot(datChange |> filter(ROI=="Cheeks"), aes(likeability, tempChangeEntireExp))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("CHEEKS change: how much partner is liked")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effects of BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

### First part of experiment (Lists)

#### Nose

No condition effect.
```{r}
summary(lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner
```{r}
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

Nose's temperature change was *less positive* when the person scored higher on extraversion.
```{r}
ggplot(datChange |> filter(ROI=="Nose"), aes(tempChangeLists, extraversion))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("NOSE change & extraversion")
```


```{r}
summary(m <- lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

#### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

#### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

People changed their forehead temperature *more positively* when they scored *higher* in *agreeableness*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(agreeableness, tempChangeLists))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & agreeableness score")
```

```{r}
summary(m <- lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


#### Cheeks

No effect of condition.
```{r}
summary(lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effects of BFI scores.
```{r}
summary(lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

### Second part of experiment (Diapix)

#### Nose

No condition effect.
```{r}
summary(lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

#### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

#### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

Forehead temperature change was *less positive* when the speaker scored higher on *likeability*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(likeability, tempChangeDiapix))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & likeability score")
```

```{r}
summary(m <- lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

Forehead temperature change was *less positive* when the speaker scored higher on *extraversion*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(extraversion, tempChangeDiapix))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & extraversion score")
```

```{r}
summary(m <- lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


#### Cheeks

No effect of condition.
```{r}
summary(m <- lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

Cheek temperature change was *less positive* when the speaker scored higher on *agreeableness*.
```{r}
ggplot(datChange |> filter(ROI=="Cheeks"), aes(agreeableness, tempChangeDiapix))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("CHEEK change & agreeableness score")
```

```{r}
summary(m <- lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

# Temperature convergence

## Per dyad

```{r}
all <- data.frame(matrix(nrow=0, ncol=7))
names(all) <- c("dyad", "condition", "ROI", "direction", "t", "p", "section")
```

```{r}
for(d in unique(dat$dyad)){
  for(r in unique(dat$ROI)){
    dd <- dat |> 
      filter(speaker==paste0(d, "-A"), ROI==r)
    if(nrow(dd)<=1){next}
    if(all(is.na(dd$tempDiff))){next}
    c <- tidy(lm(tempDiff ~ time, dd))
    all[nrow(all)+1,] <- c(d, unique(dd$condition[dd$dyad==d]), r,
                           ifelse(c$estimate[2] < 0, "convergence", "divergence"),
                           c$statistic[2],
                           c$p.value[2],
                           "entireExp")
    for(section in c("Lists", "Diapix")){
      dd <- dat |> 
        filter(speaker==paste0(d, "-A"), ROI==r, task==section)
      if(nrow(dd)<=1){next}
      if(all(is.na(dd$tempDiff))){next}
      c <- tidy(lm(tempDiff ~ time, dd))
      all[nrow(all)+1,] <- c(d, unique(dd$condition[dd$dyad==d]), r,
                             ifelse(c$estimate[2] < 0, "convergence", "divergence"),
                             c$statistic[2],
                             c$p.value[2],
                             section)
    }
  }
}

all <- all |> 
  mutate_at(c("t", "p"), as.numeric) |> 
  mutate(sign = ifelse(p<0.05, "yes", "ns"),
         effect = case_when(
           sign == "yes" & direction == "convergence" ~ "convergence",
           sign == "yes" & direction == "divergence" ~ "divergence",
           sign == "ns" ~ "ns"
         )) |> 
  mutate_at(c("direction", "dyad", "condition", "section", "ROI", "sign", "effect"), as.factor)

all$section <- factor(all$section, levels=c("Lists", "Diapix", "entireExp"))
all$ROI <- factor(all$ROI, levels=c("Forehead", "Eyes", "Nose", "Cheeks"))
```

Some dyads converged (or diverged) on some ROIs.
(Note: some people wore glasses during all or part of the experiment, hence fewer data points for the Eyes ROI.)
```{r}
table(all$sign)
ggplot(all, aes(ROI, fill=effect))+
  geom_bar()+
  facet_wrap(~section)+
  ggtitle("Significance of effects of con-/divergence in ROIs")
```

```{r}
ggplot(all |> filter(section=="entireExp"), aes(ROI, fill=effect))+
  geom_bar()+
  facet_wrap(~condition)+
  ggtitle("Significant effects per condition & ROI")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

With all ROIs taken together, neither the direction of the effect (con- vs. divergence) nor the presence of an effect (significant or not) is different between conditions.
```{r}
summary(glmer(sign ~ condition + (1|dyad), all, family=binomial))

tidy(m <- multinom_reg() |> 
       fit(effect ~ condition, data=all),
     exponentiate=TRUE, conf.int=TRUE)
```

Dyads that show an effect in one ROI are likely to show an effect in other ROIs.
```{r}
sort(table(all$dyad[all$sign!="ns" & all$section=="entireExp"]))
hist(table(all$dyad[all$sign!="ns" & all$section=="entireExp"]), main="Number of effects shown by each given dyad", xlab="Number of effects (eg, in different ROIs)")
```

(I'd like to explore whether dyads converge more/less using questionnaire scores as predictors, but I'm not sure how to do that, since the questionnaires were 1 per speaker, and the convergence measure is 1 per dyad.)

### Per ROI

```{r}
all$effect <- relevel(all$effect, ref="ns")

tidy(m <- multinom_reg() |> 
       fit(effect ~ condition, data=all |> filter(ROI=="Nose")),
     exponentiate=TRUE, conf.int=TRUE)

tidy(m <- multinom_reg() |> 
       fit(effect ~ condition, data=all |> filter(ROI=="Forehead")),
     exponentiate=TRUE, conf.int=TRUE)

tidy(m <- multinom_reg() |> 
       fit(effect ~ condition, data=all |> filter(ROI=="Eyes")),
     exponentiate=TRUE, conf.int=TRUE)

tidy(m <- multinom_reg() |> 
       fit(effect ~ condition, data=all |> filter(ROI=="Cheeks")),
     exponentiate=TRUE, conf.int=TRUE)
```


## All speakers together

**There was no robust convergence or divergence in any ROI when all speakers' data are pulled together.** Although there seemed to be a trend in some ROIs, the effect disappears completely when we add random slopes to the models.

### Nose

No con-/divergence in nose temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Nose"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Nose", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Nose", grepl("-A", speaker))))

anova(m0, m1)
```

### Forehead

No con-/divergence in forehead temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Forehead"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Forehead", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Forehead", grepl("-A", speaker))))

anova(m0, m1)
```

### Eyes

No con-/divergence in eye temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Eyes"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Eyes", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Eyes", grepl("-A", speaker))))

anova(m0, m1)
```

### Cheeks

No con-/divergence in cheek temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Cheeks"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Cheeks", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Cheeks", grepl("-A", speaker))))

anova(m0, m1)
```

# Session Info

```{r}
sessionInfo()
```

