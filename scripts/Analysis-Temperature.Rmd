---
title: "Analysis - Temperature"
author: "Tom Offrede"
output:
  html_document:
    toc: true
    toc_float: 
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(tidyverse)
library(lmerTest)
library(broom)
library(DHARMa)
library(parsnip)
library(nnet)
library(emmeans)

load(paste0(here::here(), "/data/tempData.RData"))
load(paste0(here::here(), "/data/tempDataChange.RData"))
load(paste0(here::here(), "/data/metadata-clean.RData"))
meta <- m
folderFig1 <- paste0(here::here(), "/figures/temperature/tempChange/")
folderFig2 <- paste0(here::here(), "/figures/temperature/convergence/")
```

# Summary of Results

* Most people increased the temperature in most of their ROIs, with some exceptions.

**Significant number of increases/decreases in temperature** (per speaker)

* There were overall **more significant increases** in the **impersonal** condition. In more detail:
    * First part of experiment (**Question lists**)
        * none
    * Second part of experiment (**Diapix**)
        * All ROIs together: more increases in *impersonal*; more changes overall in *impersonal*
        * Forehead: more increases in *impersonal* (adjusted p a bit above .05)
        * Cheeks: more increases in *impersonal* (adjusted p slightly above .05)
    * Across the entire experiment
        * Cheeks: more increases in *impersonal* (adjusted p above .05)

* Sometimes, there were a few temperature decreases in the close condition, but no decreases in the impersonal condition. This was true for the following:
    * First part of experiment (**Question lists**)
        * Eyes
        * Forehead
    * Second part of experiment (**Diapix**)
       * Eyes
       * Forehead

* Some effects of perception of partner:
    * First part of experiment (**Lists**)
        * Nose temperature *increased more often* when the speaker wanted *more* to be friends.
    * Second part of experiment (**Diapix**)
        * Nose temperature *decreased less often* when the speaker wanted *more* to be *friends*.
        * Eye temperature *increased less often* when the speaker felt *closer* to their partner.
        * Forehead temperature *increased less often* when the speaker *liked* their partner *more*.
        
* Some effects of personality scores:
    * First part of experiment (**Lists**)
        * Cheek temperature *increased less often* when the speaker scored higher in *agreeableness*.
    * Second part of experiment (**Diapix**)
        * Nose temperature *increased less often* when the speaker scored higher in *extraversion*.
        * Nose temperature *increased and decreased less often* when the speaker scored higher in *openness*.
        * Eye temperature *increased less often* when the speaker scored higher in *agreeableness*.
        * Forehead temperature *increased less often* when the speaker scored higher in *extraversion*.
        * Forehead temperature *increased less often* when the speaker scored higher in *openness* (small effect).
        * Cheek temperature *increased less often* when the speaker scored higher in *agreeableness*.
    * Across the entire experiment
        * Eye temperature *increased less often* when the speaker scored higher in *neuroticism*.
        * Cheek temperature *increased less often* when the speaker scored higher in *agreeableness*.
        
* Some effects of thermal comfort:
    * Second part of the experiment (**Diapix**)
        * Nose temperature had *increased and decreased less often* when the speaker felt more comfortable at the end of the experiment.
        

**Participants' temperature change across experiment** (all speakers together)

* All ROIs *except cheeks* increased temperature reliably (accounting for room temperature).
* There was no overall condition effect.

* Some effects of perception of partner:
    * Second part of experiment (**Diapix**)
        * Forehead temperature change was *less positive* when the speaker *liked* their partner *more*. (and almost significant effects in the same direction here for feelings of *closeness* and *similarity*)
    * Across the entire experiment
        * Forehead temperature change was *less positive* when the speaker *liked* their partner *more*. (and almost significant effects in the same direction here for feelings of *similarity* and *wanting to be friends*)
        * Cheek temperature change was *less positive* when the speaker *liked* their partner *more*.

* Some effects of personality scores:
    * First part of experiment (**Question lists**)
        * Nose temperature change was *less positive* when the speaker scored higher in *extraversion*.
        * Forehead temperature change was *more positive* when the speaker scored higher in *agreeableness*.
    * Second part of experiment (**Diapix**)
        * Forehead temperature change was *less positive* when the speaker scored higher in *extraversion*.
        * Cheek temperature change was *less positive* when the speaker scored higher in *agreeableness*.
    * Across the entire experiment
        * Nose temperature change was *less positive* when the speaker scored higher in *extraversion*.
        * Forehead temperature change was *less positive* when the speaker scored higher in *openness*.
        
**Temperature convergence**

* Some dyads converged or diverged in some ROIs, but there were no significant effects of condition.

# Notes

* There are 2 types of analysis:
    * Run a regression on ROI's temperature ~ time passing *for each speaker*, and then use the result of these regressions (significant increase, significant decrease, not significant) as a dependent variable of other predictors (e.g., condition and questionnaire ratings)
    * Run a regression with the speakers' absolute temperature change across the experiment (numerical) and use this as a dependent variable of other predictors.

* In the models of temperature change across time, I originally wanted to add `room temperature` as a predictor to account for the increasing room temperature. However, there is high collinearity between `room temperature` and `time`, so the models don't make sense. Hence, only `time` is kept.

* There are 2 conditions: `close`, where in the first task of the experiment the participants talked about increasingly intimate questions (adapted from the Relationship Closeness Induction Task), and `impersonal`, where they talked about impersonal questions.

* The check of residuals of logistic models below, was done following: https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html

# Individual plots

See folder: R project temperatureExp > figures > temperature > tempChange OR convergence

```{r}
# for(roi in unique(dat$ROI)){
#   ggplot(dat |> filter(ROI==roi), aes(time, temperature, color=speaker))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(roi)
#   ggsave(paste0(folderFig1, roi, ".png"), width=3000, height=2600, units = "px")
#   
#   for(con in unique(dat$condition)){
#     ggplot(dat |> filter(ROI==roi, condition==con), aes(time, temperature, color=speaker))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(paste(roi, "-", con, "condition"))
#   ggsave(paste0(folderFig1, "/", con, "/", roi, ".png"), width=3000, height=2600, units = "px")
#   }
# }
```

```{r}
# for(roi in unique(dat$ROI)){
#   d <- dat |>
#     filter(ROI==roi) |> 
#     group_by(speaker) |>
#     filter(length(unique(task))==2) |>
#     ungroup()
#     ggplot(d, aes(time, temperature, color=task))+
#       geom_point()+
#       geom_smooth(method="lm")+
#       facet_wrap(~speaker, scales = "free_x")+
#       ggtitle(roi)
#     ggsave(paste0(folderFig1, roi, "PerTask.png"), width=3000, height=2600, units = "px")
# }
```

```{r}
# for(roi in unique(dat$ROI)){
#   ggplot(dat |> filter(ROI==roi, grepl("-A", speaker)), aes(time, tempDiff))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(roi)
#   ggsave(paste0(folderFig2, roi, ".png"), width=3000, height=2600, units = "px")
#   
#   for(con in unique(dat$condition)){
#     ggplot(dat |> filter(ROI==roi, grepl("-A", speaker), condition==con), aes(time, tempDiff))+
#     geom_point()+
#     geom_smooth(method="lm")+
#     facet_wrap(~dyad, scales = "free_x")+
#     ggtitle(paste(roi, "-", con, "condition"))
#   ggsave(paste0(folderFig2, "/", con, "/", roi, ".png"), width=3000, height=2600, units = "px")
#   }
# }
```

# Temperature change across time and across conditions

## Per speaker

```{r}
all <- data.frame(matrix(nrow=0, ncol=7))
names(all) <- c("speaker", "condition", "ROI", "direction", "t", "p", "section")
```

```{r}
for(s in unique(dat$speaker)){
  for(r in unique(dat$ROI)){
    d <- dat |> filter(speaker==s, ROI==r)
    if(nrow(d)<=1){next}
    c <- tidy(lm(temperature ~ time, d))
    all[nrow(all)+1,] <- c(s, unique(d$condition), r,
                           ifelse(c$estimate[2] < 0, "negative", "positive"),
                           c$statistic[2],
                           c$p.value[2],
                           "entireExp")
    for(section in c("Lists", "Diapix")){
      d <- dat |> filter(speaker==s, ROI==r, task==section)
      if(nrow(d)==0){next}
      c <- tidy(lm(temperature ~ time, d))
      all[nrow(all)+1,] <- c(s, unique(d$condition), r,
                             ifelse(c$estimate[2] < 0, "negative", "positive"),
                             c$statistic[2],
                             c$p.value[2],
                             section)
    }
  }
}

all <- all |> 
  mutate_at(c("t", "p"), as.numeric) |> 
  mutate(sign = ifelse(p < 0.05, "yes", "ns"),
         effect = case_when(
           sign == "yes" & direction == "positive" ~ "increase",
           sign == "yes" & direction == "negative" ~ "decrease",
           sign == "ns" ~ "ns",
         )) |> 
  mutate_at(c("direction", "speaker", "effect", "condition", "section", "ROI"), as.factor)

all$section <- factor(all$section, levels=c("Lists", "Diapix", "entireExp"))
all$effect <- relevel(all$effect, ref="ns")

# # save it
# indTemp <- all
# save(indTemp, file=paste0(here::here(), "/data/individualTemp.RData"))
```

There were more significant changes within each section than when the entire experiment period was taken. This seems meaningful, since the entire experiment has more data points than each section individually.
```{r}
table(paste(all$sign, all$section))
```

But the direction of temperature change was always the same (mostly positive) in each section.

The individual plots divided per 1st vs 2nd part of experiment show that most participants had a linear change across the experiment, but not all.
```{r}
summary(glmer(direction ~ section + (1|speaker), all |> filter(section!="entireExp"), family=binomial))
```

```{r}
ggplot(all, aes(ROI, fill=effect))+
  geom_bar()+
  facet_wrap(condition~section)+
  ggtitle("Temperature change across ROIs & conditions")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```


### Questionnaire scores as predictors?

#### First part of experiment (Lists)

```{r}
d <- merge(all |> 
             filter(section == "Lists") |>
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

```{r}
# data set for poisson regression

dt <- d |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n()) |> 
  right_join(crossing(effect = unique(d$effect), condition = unique(d$condition), ROI = unique(d$ROI))) |> 
  mutate(count = replace_na(count, 0))
conditionCount <- d |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
# contrasts(dt$condition) <- c(-.5,+.5)
dt$condition <- relevel(dt$condition, ref="close")
```

##### All ROIs together

No condition effect
```{r}
ggplot(d, aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("All ROIs: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d)) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(m <- glmer(sign ~ condition + (1|speaker), d, family=binomial))
```

##### Nose

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("NOSE: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))

# two (more) options of plots:

# ggeffects::ggpredict(m, terms=c("effect", "condition")) |> 
#   as_tibble()  |>
#   ggplot() +
#   aes(x = group, y = predicted) +
#   facet_grid(.~x) +
#   geom_point() +
#   geom_errorbar(aes(ymin=conf.low, ymax = conf.high)) +
#   geom_line(group = 1)
# 
# ggeffects::ggpredict(m, terms=c("effect", "condition")) |> 
#   as_tibble()  |>
#   ggplot() +
#   aes(x = group, y = predicted) +
#   facet_grid(.~x) +
#   geom_col() +
#   geom_errorbar(aes(ymin=conf.low, ymax = conf.high), width = .3)

```

People *increased* their temperature *more often* when they wanted more to *become friends* with their partner. When performing pairwise comparison and adjusting the p value, it became a little over .05 (i.e. .055)
```{r}
ggplot(d |> filter(ROI=="Nose"), aes(effect, becomeFriends))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of BFI scores
```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

##### Eyes

```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("EYES: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of the perception of their partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of BFI scores
```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```


##### Forehead

```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("FOREHEAD: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

No effect of the perception of their partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of BFI scores
```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

##### Cheeks

```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("CHEEKS: Temperature change across conditions (Lists)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of the perception of their partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Cheek temperature *increased less often* when the speaker scored higher in *agreeableness*. BUT pairwise comparison not running.
```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(effect, agreeableness))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

#### Second part of experiment (Diapix)

```{r}
d <- merge(all |> 
             filter(section == "Diapix") |>
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

```{r}
# data set for poisson regression

dt <- d |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n()) |> 
  right_join(crossing(effect = unique(d$effect), condition = unique(d$condition), ROI = unique(d$ROI))) |> 
  mutate(count = replace_na(count, 0))
conditionCount <- d |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
# contrasts(dt$condition) <- c(-.5,+.5)
dt$condition <- relevel(dt$condition, ref="close")
```

##### All ROIs together

Overall, there were more temperature *increases* in the *impersonal* condition.

There were also *fewer* non-effects in the *impersonal* condition.

```{r}
ggplot(d, aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("All ROIs: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d)) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(m <- glmer(sign ~ condition + (1|speaker), d, family=binomial))
```

##### Nose

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("NOSE: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Nose"), family=binomial))
```

People *decrease* their temperature *more often* when they wanted more to *become friends* with their partner.
```{r}
ggplot(d |> filter(ROI=="Nose"), aes(effect, becomeFriends))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Nose temperature *increased less often* when the person scored higher on *extraversion.* 
```{r}
ggplot(d |> filter(ROI=="Nose"), aes(effect, extraversion))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Nose temperature tended to *change less often* (both directions) when the person scored higher on *openness*. But only the p value of the temperature *increases* stayed significant after adjustment.
```{r}
ggplot(d |> filter(ROI=="Nose"), aes(effect, openness))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
ggplot(d |> filter(ROI=="Nose"), aes(effect, comfortPost))+
  geom_boxplot()
```

Nose temperature had *increased and decreased less often* when the speaker felt more comfortable at the end of the experiment. 
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

##### Eyes

```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("EYES: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

Eye temperature *increased less often* when the speaker felt *closer* to their partner.
```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(effect, likeability))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Eye temperature *increased less often* when the speaker scored higher on agreeableness.
```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(effect, agreeableness))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```


##### Forehead

```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("FOREHEAD: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

More increases in *impersonal*, but adjusted p value = 0.07
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

Forehead temperature *increased less often* when the speaker *liked* their partner *more*.
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(effect, likeability))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Forehead temperature *increased less often* when the speaker scored higher in *extraversion.*
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(effect, extraversion))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Forehead temperature also *increased less often* when the speaker scored higher in *openness*.
```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(effect, openness))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

##### Cheeks

```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("CHEEKS: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

Cheek temperature tended to *increase more often* in the *impersonal* condition, but the adjusted p value was slightly above 0.05 (i.e., 0.053).
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of the perception of their partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Cheek temperature *increased* less often when the speaker scored higher in agreeableness.
```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(effect, agreeableness))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```


#### Entire experiment

```{r}
d <- merge(all |> 
             filter(section == "entireExp") |>
             select(-condition) |> 
             mutate_at(c("sign", "effect"), as.factor),
           meta, by="speaker") |> 
  mutate_at("condition", as.factor)
```

```{r}
# data set for poisson regression

dt <- d |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n()) |> 
  right_join(crossing(effect = unique(d$effect), condition = unique(d$condition), ROI = unique(d$ROI))) |> 
  mutate(count = replace_na(count, 0))
conditionCount <- d |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
contrasts(dt$condition) <- c(-.5,+.5)
```

##### All ROIs together

* With all ROIs taken together, there were overall more changes in the impersonal condition, both increases and decreases.

```{r}
ggplot(d, aes(condition, fill=effect))+
  geom_bar()+
  # facet_wrap(~condition)+
  ggtitle("All ROIs: Temperature change across conditions (entire exp)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No significant effect of condition, but almost
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d)) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(m <- glmer(sign ~ condition + (1|speaker), d, family=binomial))
```


##### Nose

```{r}
ggplot(d |> filter(ROI=="Nose"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("NOSE: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glm(sign ~ condition, d |> filter(ROI=="Nose"), family=binomial)) # not converging with the random intercepts
```

No effect of perception of partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of BFI scores
```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

##### Eyes

```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("EYES: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Eyes"), family=binomial))
```

No effect of perception of partner.
```{r}
# there's a warning about the `decrease` level being empty, but I already checked with a dataset where I `droplevel()`'d `effect` and it didn't affect the model

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Eye temperature seemed to *increase less often* when the speaker scored higher on neuroticism.
```{r}
ggplot(d |> filter(ROI=="Eyes"), aes(effect, neuroticism))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```


##### Forehead

```{r}
ggplot(d |> filter(ROI=="Forehead"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("FOREHEAD: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

No effect of condition
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Forehead"), family=binomial))
```

No effect of the perception of their partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of perception of their partner
```{r}
tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

##### Cheeks

```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("CHEEKS: Temperature change across conditions (Diapix)")+
  scale_fill_manual(values = c("decrease" = "lightblue", "increase" = "red", "ns" = "gray"))
```

Cheek temperature tended to *increase more often* in the *impersonal* condition, but the adjusted p value was above 0.05.
```{r}
tidy(m <- nnet::multinom(effect ~ condition, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")

summary(m <- glmer(sign ~ condition + (1|speaker), d |> filter(ROI=="Cheeks"), family=binomial))
```

No effect of the perception of their partner.
```{r}
tidy(m <- nnet::multinom(effect ~ becomeFriends, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ closeness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ similarity, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ likeability, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

Cheek temperature tended to *increase less often* when the speaker scored higher in agreeableness, but the pairwise comparison isn't computing. And the effect also seems rather small.
```{r}
ggplot(d |> filter(ROI=="Cheeks"), aes(effect, agreeableness))+
  geom_boxplot()
```

```{r}
tidy(m <- nnet::multinom(effect ~ agreeableness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ extraversion, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ openness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ conscientiousness, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ neuroticism, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

No effect of thermal comfort
```{r}
tidy(m <- nnet::multinom(effect ~ comfortPre, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities

tidy(m <- nnet::multinom(effect ~ comfortPost, data=d |> filter(ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
```

## All speakers together

### Temperature across time

#### Nose

Nose got warmer across time, no difference between conditions.

Preferred model: `temperature ~ time : roomTemp + (time||speaker)`

```{r}
ggplot(dat |> filter(ROI=="Nose"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (time||speaker) , dat |> filter(ROI=="Nose")))

summary(m1 <- lmer(temperature ~ time + roomTemp + (time||speaker) , dat |> filter(ROI=="Nose")))

summary(m2 <- lmer(temperature ~ time : condition + roomTemp + (time||speaker) , dat |> filter(ROI=="Nose")))

anova(m0, m1)
anova(m1, m2)
```

#### Forehead

Forehead got warmer across time, no difference between conditions.

Preferred model: `temperature ~ time + roomTemp + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Forehead"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Forehead")))
summary(m1 <- lmer(temperature ~ time + roomTemp + (1+time|speaker), dat |> filter(ROI=="Forehead")))
summary(m2 <- lmer(temperature ~ time : condition + roomTemp + (1+time|speaker), dat |> filter(ROI=="Forehead"))) # but failed to converge

anova(m0, m1)
anova(m1, m2)
```

#### Eyes

Eyes got warmer across time, no difference between conditions.

Preferred model: `temperature ~ time + (time||speaker)`


```{r}
ggplot(dat |> filter(ROI=="Eyes"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (time||speaker), dat |> filter(ROI=="Eyes")))
summary(m1 <- lmer(temperature ~ time + roomTemp + (time||speaker), dat |> filter(ROI=="Eyes")))
summary(m2 <- lmer(temperature ~ time : condition + (time||speaker), dat |> filter(ROI=="Eyes")))

anova(m0, m1) # this time the model without `roomTemp` was preferred
anova(m0, m2)
```

#### Cheeks

Cheeks did not change temperature.

Preferred model: `temperature ~ time + roomTemp + (1+time|speaker)`

```{r}
ggplot(dat |> filter(ROI=="Cheeks"), aes(time, temperature))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(temperature ~ time + (1+time|speaker), dat |> filter(ROI=="Cheeks")))
summary(m1 <- lmer(temperature ~ time + roomTemp + (1+time|speaker), dat |> filter(ROI=="Cheeks")))
summary(m2 <- lmer(temperature ~ time : condition + roomTemp + (1+time|speaker), dat |> filter(ROI=="Cheeks")))

anova(m0, m1)
anova(m1, m2)
```

### Temperature change -- exploration of possible predictors

All the effects below are small and with the residuals not normally distributed. This is probably due to the small size of the data set. So these effects aren't the most reliable.

#### First part of experiment (Lists)

##### Nose

No condition effect.
```{r}
summary(lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner
```{r}
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

Nose's temperature change was *less positive* when the person scored higher on extraversion.
```{r}
ggplot(datChange |> filter(ROI=="Nose"), aes(tempChangeLists, extraversion))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("NOSE change & extraversion")
```


```{r}
summary(m <- lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

##### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

##### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

People changed their forehead temperature *more positively* when they scored *higher* in *agreeableness*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(tempChangeLists, agreeableness))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & agreeableness score")
```

```{r}
summary(m <- lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


##### Cheeks

No effect of condition.
```{r}
summary(lmer(tempChangeLists ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeLists ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effects of BFI scores.
```{r}
summary(lmer(tempChangeLists ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeLists ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

#### Second part of experiment (Diapix)

##### Nose

No condition effect.
```{r}
summary(lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

##### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

##### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

Forehead temperature change was *less positive* when the speaker scored higher on *likeability*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(tempChangeDiapix, likeability))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & likeability score")
```

```{r}
summary(m <- lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

Forehead temperature change was *less positive* when the speaker scored higher on *extraversion*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(tempChangeDiapix, extraversion))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & extraversion score")
```

```{r}
summary(m <- lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


##### Cheeks

No effect of condition.
```{r}
summary(m <- lmer(tempChangeDiapix ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeDiapix ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

Cheek temperature change was *less positive* when the speaker scored higher on *agreeableness*.
```{r}
ggplot(datChange |> filter(ROI=="Cheeks"), aes(agreeableness, tempChangeDiapix))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("CHEEK change & agreeableness score")
```

```{r}
summary(m <- lmer(tempChangeDiapix ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeDiapix ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeDiapix ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

#### Entire Experiment

##### Nose

No condition effect.
```{r}
summary(lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Nose")))
```

No effect of perception of partner
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Nose")))
```

Nose temperature change was *less positive* when the person scored higher on extraversion.
```{r}
ggplot(datChange |> filter(ROI=="Nose"), aes(tempChangeEntireExp, extraversion))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("NOSE change & extraversion")
```


```{r}
summary(m <- lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Nose")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Nose")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Nose")))
```

##### Eyes

No condition effect.
```{r}
summary(lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of perception of partner.
```{r}
summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

No effect of BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Eyes")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Eyes")))
```

##### Forehead

No effect of condition.
```{r}
summary(m <- lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

It seems that people that *liked* their partner more changed forehead temperature *less positively*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(tempChangeEntireExp, likeability))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change: how much partner is liked")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Forehead")))
```

People changed their forehead temperature *less positively* when they scored *higher* in *openness*.
```{r}
ggplot(datChange |> filter(ROI=="Forehead"), aes(tempChangeEntireExp, openness))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("FOREHEAD change & openness score")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Forehead")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Forehead")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Forehead")))
```


##### Cheeks

No effect of condition.
```{r}
summary(m <- lmer(tempChangeEntireExp ~ condition + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

Cheeks changed temperature *less positively* when the speaker liked their partner *more*.
```{r}
ggplot(datChange |> filter(ROI=="Cheeks"), aes(tempChangeEntireExp, likeability))+
  geom_point()+
  geom_smooth(method="lm")+
  ggtitle("CHEEKS change: how much partner is liked")
```

```{r}
summary(m <- lmer(tempChangeEntireExp ~ likeability + (1|dyad), datChange |> filter(ROI=="Cheeks")))
par(mfrow=c(2, 2))
hist(resid(m))
qqnorm(resid(m));qqline(resid(m))
plot(fitted(m), resid(m))

summary(lmer(tempChangeEntireExp ~ closeness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ similarity + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ becomeFriends + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

No effects of BFI scores.
```{r}
summary(lmer(tempChangeEntireExp ~ agreeableness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ extraversion + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ openness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ conscientiousness + (1|dyad), datChange |> filter(ROI=="Cheeks")))
summary(lmer(tempChangeEntireExp ~ neuroticism + (1|dyad), datChange |> filter(ROI=="Cheeks")))
```

# Temperature convergence

## Per dyad

```{r}
all <- data.frame(matrix(nrow=0, ncol=7))
names(all) <- c("dyad", "condition", "ROI", "direction", "t", "p", "section")
```

```{r}
for(d in unique(dat$dyad)){
  for(r in unique(dat$ROI)){
    dd <- dat |> 
      filter(speaker==paste0(d, "-A"), ROI==r)
    if(nrow(dd)<=1){next}
    if(all(is.na(dd$tempDiff))){next}
    c <- tidy(lm(tempDiff ~ time, dd))
    all[nrow(all)+1,] <- c(d, unique(dd$condition[dd$dyad==d]), r,
                           ifelse(c$estimate[2] < 0, "convergence", "divergence"),
                           c$statistic[2],
                           c$p.value[2],
                           "entireExp")
    for(section in c("Lists", "Diapix")){
      dd <- dat |> 
        filter(speaker==paste0(d, "-A"), ROI==r, task==section)
      if(nrow(dd)<=1){next}
      if(all(is.na(dd$tempDiff))){next}
      c <- tidy(lm(tempDiff ~ time, dd))
      all[nrow(all)+1,] <- c(d, unique(dd$condition[dd$dyad==d]), r,
                             ifelse(c$estimate[2] < 0, "convergence", "divergence"),
                             c$statistic[2],
                             c$p.value[2],
                             section)
    }
  }
}

all <- all |> 
  mutate_at(c("t", "p"), as.numeric) |> 
  mutate(sign = ifelse(p<0.05, "yes", "ns"),
         effect = case_when(
           sign == "yes" & direction == "convergence" ~ "convergence",
           sign == "yes" & direction == "divergence" ~ "divergence",
           sign == "ns" ~ "ns"
         )) |> 
  mutate_at(c("direction", "dyad", "condition", "section", "ROI", "sign", "effect"), as.factor)

all$section <- factor(all$section, levels=c("Lists", "Diapix", "entireExp"))
all$effect <- factor(all$effect, levels=c("ns", "divergence", "convergence"))
all$ROI <- factor(all$ROI, levels=c("Forehead", "Eyes", "Nose", "Cheeks"))

# data set for poisson regression

dt <- all |> 
  group_by(effect, condition, ROI) |> 
  summarize(count = n()) |> 
  right_join(crossing(effect = unique(all$effect), condition = unique(all$condition), ROI = unique(all$ROI))) |> 
  mutate(count = replace_na(count, 0))
conditionCount <- all |> 
  group_by(condition, ROI) |> 
  summarize(condCount = n())
dt <- merge(dt, conditionCount, by=c("condition", "ROI"))

dt$effect <- relevel(dt$effect, ref="ns")
# contrasts(dt$condition) <- c(-.5,+.5)
dt$condition <- relevel(dt$condition, ref="close")
```

Some dyads converged (or diverged) on some ROIs.
(Note: some people wore glasses during all or part of the experiment, hence fewer data points for the Eyes ROI.)
```{r}
table(all$sign)
ggplot(all, aes(ROI, fill=effect))+
  geom_bar()+
  facet_wrap(~section)+
  ggtitle("Significance of effects of con-/divergence in ROIs")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```


Dyads that show an effect in one ROI are likely to show an effect in other ROIs.
```{r}
sort(table(all$dyad[all$sign!="ns" & all$section=="entireExp"]))
hist(table(all$dyad[all$sign!="ns" & all$section=="entireExp"]), main="Number of effects shown by each given dyad", xlab="Number of effects (eg, in different ROIs)")
```

(I'd like to explore whether dyads converge more/less using questionnaire scores as predictors, but I'm not sure how to do that, since the questionnaires were 1 per speaker, and the convergence measure is 1 per dyad.)

### First part of experiment (Lists)

#### All ROIs

No difference between conditions
```{r}
ggplot(all |> filter(section=="Lists"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("Significant effects per condition (entire exp)")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
summary(glmer(sign ~ condition + (1|dyad), all |> filter(section=="Lists"), family=binomial))

tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Lists"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Nose

No difference in nose convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Nose", section=="Lists"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("NOSE: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Lists", ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Forehead

No difference in forehead convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Forehead", section=="Lists"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("Forehead: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Lists", ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Eyes

There are no convergence or divergence effects in the impersonal condition, but also much fewer data points overall, so this isn't necessarily informative.

```{r}
ggplot(all |> filter(ROI=="Eyes", section=="Lists"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("EYES: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Lists", ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Cheeks

No difference in cheek convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Cheeks", section=="Lists"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("CHEEKS: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Lists", ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

### Second part of experiment (Diapix)

#### All ROIs

```{r}
ggplot(all |> filter(section=="Diapix"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("Significant effects per condition (entire exp)")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
summary(glmer(sign ~ condition + (1|dyad), all |> filter(section=="Diapix"), family=binomial))

tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Diapix"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Nose

No difference in nose convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Nose", section=="Diapix"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("NOSE: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Diapix", ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Forehead

No difference in forehead convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Forehead", section=="Diapix"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("Forehead: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Diapix", ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Eyes

No difference in eye convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Eyes", section=="Diapix"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("EYES: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Diapix", ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Cheeks

No difference in cheek convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Cheeks", section=="Diapix"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("CHEEKS: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="Diapix", ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

### Across entire experiment

#### All ROIs

```{r}
ggplot(all |> filter(section=="entireExp"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("Significant effects per condition (entire exp)")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
summary(glmer(sign ~ condition + (1|dyad), all |> filter(section=="entireExp"), family=binomial))

tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="entireExp"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Nose

No difference in nose convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Nose", section=="entireExp"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("NOSE: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="entireExp", ROI=="Nose"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Forehead

No difference in forehead convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Forehead", section=="entireExp"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("Forehead: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="entireExp", ROI=="Forehead"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Eyes

No difference in eye convergence between conditions.

```{r}
ggplot(all |> filter(ROI=="Eyes", section=="entireExp"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("EYES: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="entireExp", ROI=="Eyes"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

#### Cheeks

More cheek divergence (or rather: cheek divergence *only*) in the *close* condition.

```{r}
ggplot(all |> filter(ROI=="Cheeks", section=="entireExp"), aes(condition, fill=effect))+
  geom_bar()+
  ggtitle("CHEEKS: Temperature convergence")+
  scale_fill_manual(values = c("divergence" = "lightblue", "convergence" = "red", "ns" = "gray"))
```

```{r}
tidy(m <- nnet::multinom(effect ~ condition, data= all |> filter(section=="entireExp", ROI=="Cheeks"))) |> 
  as_tibble() |> 
  mutate(estimate = plogis(estimate)) # plogis transforms log odds (the output of the model) into probabilities
emmeans(m, pairwise~condition, by="effect")
```

## All speakers together

**There was no robust convergence or divergence in any ROI when all speakers' data are pulled together.** Although there seemed to be a trend in some ROIs, the effect disappears completely when we add random slopes to the models.

### Nose

No con-/divergence in nose temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Nose"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Nose", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Nose", grepl("-A", speaker))))

anova(m0, m1)
```

### Forehead

No con-/divergence in forehead temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Forehead"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Forehead", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Forehead", grepl("-A", speaker))))

anova(m0, m1)
```

### Eyes

No con-/divergence in eye temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Eyes"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Eyes", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Eyes", grepl("-A", speaker))))

anova(m0, m1)
```

### Cheeks

No con-/divergence in cheek temperature.

Preferred model: `tempDiff ~ time + (1+time|dyad)`

```{r}
ggplot(dat |> filter(ROI=="Cheeks"), aes(time, tempDiff))+
  geom_point()+
  geom_smooth(method="lm")+
  facet_wrap(~condition)
```

```{r}
summary(m0 <- lmer(tempDiff ~ time + (1+time|dyad), dat |> filter(ROI=="Cheeks", grepl("-A", speaker))))
summary(m1 <- lmer(tempDiff ~ time : condition + (1+time|dyad), dat |> filter(ROI=="Cheeks", grepl("-A", speaker))))

anova(m0, m1)
```

# Session Info

```{r}
sessionInfo()
```

